<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>13支-比牌環節</title>
    <style>
        body {
            background-image: url("imgs/牌桌.png");
            background-repeat: no-repeat;
            background-size: cover;
        }

        #compare {
            position: absolute;
            width: 15%;
            top: 38%;
            left: 42.5%;
        }
    </style>
</head>
<body>
    <img onclick="COMPARE()" id="compare" />
    <script>
            let data = {};
            let queryString = window.location.search;// 獲得網址字串
            let A1 = new Array(3), A2 = new Array(5), A3 = new Array(5);//玩家1
            let p2 = new Array(16);
            let B1 = new Array(3), B2 = new Array(5), B3 = new Array(5);//玩家2
            let p3 = new Array(16);
            let C1 = new Array(3), C2 = new Array(5), C3 = new Array(5);//玩家3
            let p4 = new Array(16);
            let D1 = new Array(3), D2 = new Array(5), D3 = new Array(5);//玩家4
            let now_for_compare = 1;
            let sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            let now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            let test1 = 0, test2 = 0, test3 = 0, index = 0, gold = 0;
            function getdata() {
                queryString = queryString.substring(1);// 去除問號
                queryString.split("&").forEach(function (keyValue) {// 把資料放到data
                    var parts = keyValue.split("=");
                    data[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);
                });
                //key1:頭墩//key2:二道//key3:尾墩//key4:玩家2//key5:玩家3//key6:玩家4//key7:當前局數
                A1 = data.key1.split(',');
                for (let i = 0; i <= 2; i++) { A1[i] = parseInt(A1[i]) }
                A2 = data.key2.split(',');
                for (let i = 0; i <= 4; i++) { A2[i] = parseInt(A2[i]) }
                A3 = data.key3.split(',');
                for (let i = 0; i <= 4; i++) { A3[i] = parseInt(A3[i]) }
                p2 = data.key4.split(',');
                p3 = data.key5.split(',');
                p4 = data.key6.split(',');
                now_for_compare = parseInt(data.key7);
                document.getElementById("compare").src = "imgs/比較" + now_for_compare + ".png";
                for (let i = 0; i <= 15; i++) { p2[i] = parseInt(p2[i]) }
                for (let i = 0; i <= 15; i++) { p3[i] = parseInt(p3[i]) }
                for (let i = 0; i <= 15; i++) { p4[i] = parseInt(p4[i]) }
                console.log("AI前:")
                console.log(p2); console.log(p3); console.log(p4);
                AI(p2, B1, B2, B3, 1);
                AI(p3, C1, C2, C3, 2);
                AI(p4, D1, D2, D3, 3);
                console.log("AI後:")
                console.log(B1, B2, B3); console.log(C1, C2, C3); console.log(D1, D2, D3);
            }
            function head() {

            }
            function mid() {

            }
            function tail() {

            }
            function COMPARE() {//Step1:先得到牌型Step2:比牌型Step3:比同牌型大小
                switch (now_for_compare) {
                    case 1://比較頭墩
                        head();
                        break;
                    case 2://比較二道
                        mid();
                        break;
                    case 3://比較尾墩
                        tail();
                        break;
                }
            }
            function AI(AIarray, head, mid, tail, bcd) {//五枚>同花順>彩金鐵支>鐵支>彩金葫蘆>葫蘆>對子同花>同花>順子>彩金三條>三條>兩對<一對>烏龍
                //頭:衝三++//二道:彩金三條、彩金葫蘆、鐵支、同花順、彩金鐵支、五枚++//尾:同二道
                //五枚
                test1 = 0; test2 = 0; test3 = 0;
                sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                index = 0;
                for (let j = 0; j < 16; j++) {
                    sys[AIarray[j] % 13] += 1;
                }
                for (let j = 0; j < 13; j++) {
                    if (sys[j] == 5) {
                        for (let k = 0; k < 16; k++) {
                            if (AIarray[k] % 13 == j) {
                                if (test3 == 0) {
                                    test3 = 1;
                                    tail[index] = AIarray[k];
                                    index += 1;
                                    AIarray[k] = -1;
                                }
                                else if (test2 == 0) {
                                    test2 = 1;
                                    mid[index] = AIarray[k];
                                    index += 1;
                                    AIarray[k] = -1;
                                }
                            }
                        }
                    }
                }
                //同花順
                sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                index = 0;
                for (let j = 0; j < 16; j++) {
                    if (AIarray[j] > 0 && AIarray[j] < 14) {
                        sys[0]++;
                    }
                    if (AIarray[j] > 13 && AIarray[j] < 27) {
                        sys[1]++;
                    }
                    if (AIarray[j] > 26 && AIarray[j] < 40) {
                        sys[2]++;
                    }
                    if (AIarray[j] > 39) {
                        sys[3]++;
                    }
                }
                for (let j = 0; j < 4; j++) {
                    if (sys[j] > 4) {
                        switch (j) {
                            case 0://梅花
                                now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] <= 13) {
                                        now[AIarray[k] - 1] = 1;
                                    }
                                }
                                for (let k = 0; k < 9; k++) {
                                    i = 0;
                                    if (now[k] > 0 && now[k + 1] > 0 && now[k + 2] > 0 && now[k + 3] > 0 && now[k + 4] > 0) {
                                        i = 1;
                                        gold = k + 1;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 13) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                break;
                                            }
                                        }
                                        gold = k + 2;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 13) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 3;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 13) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 4;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 13) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 5;
                                        if (gold == 13) gold = 0;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 13) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        if (test3 == 0) {
                                            test3 = 1;
                                        }
                                        else if (test2 == 0) {
                                            test2 = 1;
                                        }
                                    }

                                }
                                break;
                            case 1://磚塊
                                now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] <= 26 && AIarray[k] >= 14) {
                                        gold = AIarray[k] % 13;
                                        if (gold != 0) {
                                            now[gold - 1] = 1;
                                        }
                                        else {
                                            now[12] = 1;
                                        }
                                    }
                                }
                                for (let k = 0; k < 9; k++) {
                                    i = 0;
                                    if (now[k] > 0 && now[k + 1] > 0 && now[k + 2] > 0 && now[k + 3] > 0 && now[k + 4] > 0) {

                                        i = 1;
                                        gold = k + 1;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 26 && AIarray[l] >= 14) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 2;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 26 && AIarray[l] >= 14) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 3;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 26 && AIarray[l] >= 14) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 4;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 26 && AIarray[l] >= 14) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 5;
                                        if (gold == 13) gold = 0;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 26 && AIarray[l] >= 14) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        if (test3 == 0) {
                                            test3 = 1;
                                        }
                                        else if (test2 == 0) {
                                            test2 = 1;
                                        }
                                    }
                                }
                                break;
                            case 2://愛心
                                now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] <= 39 && AIarray[k] >= 27) {
                                        gold = AIarray[k] % 13;
                                        if (gold != 0) {
                                            now[gold - 1] = 1;
                                        }
                                        else {
                                            now[12] = 1;
                                        }
                                    }
                                }
                                for (let k = 0; k < 9; k++) {
                                    i = 0;
                                    if (now[k] > 0 && now[k + 1] > 0 && now[k + 2] > 0 && now[k + 3] > 0 && now[k + 4] > 0) {

                                        i == 1;
                                        gold = k + 1;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 39 && AIarray[l] >= 27) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 2;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 39 && AIarray[l] >= 27) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 3;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 39 && AIarray[l] >= 27) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 4;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 39 && AIarray[l] >= 27) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 5;
                                        if (gold == 13) gold = 0;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] <= 39 && AIarray[l] >= 27) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        if (test3 == 0) {
                                            test3 = 1;
                                        }
                                        else if (test2 == 0) {
                                            test2 = 1;
                                        }
                                    }
                                }
                                break;
                            case 3://黑桃
                                now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] >= 40) {
                                        gold = AIarray[k] % 13;
                                        if (gold != 0) {
                                            now[gold - 1] = 1;
                                        }
                                        else {
                                            now[12] = 1;
                                        }
                                    }
                                }
                                for (let k = 0; k < 9; k++) {
                                    i = 0;
                                    if (now[k] > 0 && now[k + 1] > 0 && now[k + 2] > 0 && now[k + 3] > 0 && now[k + 4] > 0) {
                                        i = 1;
                                        gold = k + 1;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] >= 40) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 2;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] >= 40) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 3;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] >= 40) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 4;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] >= 40) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        gold = k + 5;
                                        if (gold == 13) gold = 0;
                                        for (let l = 0; l < 16; l++) {
                                            if (AIarray[l] % 13 == gold && AIarray[l] >= 40) {
                                                if (test3 == 0) {
                                                    tail[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                                else if (test2 == 0) {
                                                    mid[index] = AIarray[l];
                                                    index += 1;
                                                    AIarray[l] = -1;
                                                }
                                            }
                                        }
                                        if (test3 == 0) {
                                            test3 = 1;
                                        }
                                        else if (test2 == 0) {
                                            test2 = 1;
                                        }
                                    }
                                }
                                break;
                        }
                    }
                }
                //鐵支
                sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                index = 0;
                for (let j = 0; j < 16; j++) {
                    sys[AIarray[j] % 13] += 1;
                }
                for (let j = 0; j < 13; j++) {
                    if (sys[j] == 4) {
                        if (test3 == 0) {
                            test3 = -1;
                            for (let k = 0; k < 16; k++) {
                                if (AIarray[k] % 13 == j) {
                                    tail[index] = AIarray[k];
                                    index += 1;
                                    AIarray[k] = -1;
                                }
                            }
                        }
                        else if (test2 == 0) {
                            test2 = -1;
                            for (let k = 0; k < 16; k++) {
                                if (AIarray[k] % 13 == j) {
                                    tail[index] = AIarray[k];
                                    index += 1;
                                    AIarray[k] = -1;
                                }
                            }
                        }
                        break;
                    }
                }
                //衝三判定(如果尾敦已經放置再衝(代表尾敦至少有鐵支以上))
                if (test3 != 0) {
                    sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                    index = 0;
                    for (let j = 0; j < 16; j++) {
                        sys[AIarray[j] % 13] += 1;
                    }
                    for (let j = 0; j < 13; j++) {
                        if (sys[j] == 3) {
                            for (let k = 0; k < 16; k++) {
                                if (AIarray[k] % 13 == j) {
                                    head[index] = AIarray[k];
                                    index += 1;
                                    AIarray[k] = -1;
                                    now[index + 10] = k;
                                }
                            }
                            break;
                        }
                    }
                    if (test1 == 1) {//有三條可當頭，判斷有沒有合適的二道
                        //葫蘆
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                now[3]++;
                            }
                            if (sys[j] == 2) {
                                now[4]++;
                            }
                        }
                        index = 0;
                        if (now[3] > 0 && now[4] > 0) {
                            test2 = 1;
                            for (let j = 0; j < 13; j++) {
                                if (sys[j] == 3) {
                                    for (let k = 0; k < 16; k++) {
                                        if (AIarray[k] % 13 == j) {
                                            mid[index] = AIarray[k];
                                            index += 1;
                                            AIarray[k] = -1;
                                        }
                                    }
                                    break;
                                }
                            }
                            for (let j = 0; j < 13; j++) {
                                if (sys[j] == 2) {
                                    for (let k = 0; k < 16; k++) {
                                        if (AIarray[k] % 13 == j) {
                                            mid[index] = AIarray[k];
                                            index += 1;
                                            AIarray[k] = -1;
                                        }
                                    }
                                    break;
                                }
                            }
                        }

                        //同花
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            if (AIarray[j] > 0 && AIarray[j] < 14) {
                                sys[0]++;
                            }
                            if (AIarray[j] > 13 && AIarray[j] < 27) {
                                sys[1]++;
                            }
                            if (AIarray[j] > 26 && AIarray[j] < 40) {
                                sys[2]++;
                            }
                            if (AIarray[j] > 39) {
                                sys[3]++;
                            }
                        }
                        for (let j = 0; j < 4; j++) {
                            if (sys[j] >= 5) {
                                test2 = 1;
                                for (let k = 0; k < 16; k++) {
                                    if (j == 3 && AIarray[k] > 39) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        if (index == 5) break;
                                    }
                                    else if (AIarray[k] < (14 + 13 * j) && AIarray[k] > (13 * j)) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        if (index == 5) break;
                                    }
                                }
                                break;
                            }
                        }
                        //順子
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            gold = AIarray[j] % 13;
                            if (gold != 0) {
                                sys[gold - 1] += 1;
                            }
                            else {
                                sys[12] += 1;
                            }
                        }
                        for (let j = 0; j < 9; j++) {
                            if (sys[j] > 0 && sys[j + 1] > 0 && sys[j + 2] > 0 && sys[j + 3] > 0 && sys[j + 4] > 0) {
                                test2 = 1;
                                gold = j + 1;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 2;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 3;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 4;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 5;
                                if (gold == 13) gold = 0;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                break;
                            }
                        }
                        //三條
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                test2 = -2;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test2 == 0) {//沒有合適的二道(回歸到放尾的情況)
                        AIarray[now[10]] = head[0];
                        AIarray[now[11]] = head[1];
                        AIarray[now[12]] = head[2];
                        head = [0, 0, 0];
                    }
                    else {//都放好了(但可能缺牌)
                        test = 1;
                    }
                }
                //到現在有幾種可能1.已經放好(111)2.一墩都沒放(000)3.放了尾(001)
                if (test1 == 1) {//放好
                    //end
                }
                else {//其他
                    //葫蘆
                    if (test3 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                now[3]++;
                            }
                            if (sys[j] == 2) {
                                now[4]++;
                            }
                        }
                        index = 0;
                        if (now[3] > 0 && now[4] > 0) {
                            test3 = 1;
                            for (let j = 0; j < 13; j++) {
                                if (sys[j] == 3) {
                                    for (let k = 0; k < 16; k++) {
                                        if (AIarray[k] % 13 == j) {
                                            tail[index] = AIarray[k];
                                            index += 1;
                                            AIarray[k] = -1;
                                        }
                                    }
                                    break;
                                }
                            }
                            for (let j = 0; j < 13; j++) {
                                if (sys[j] == 2) {
                                    for (let k = 0; k < 16; k++) {
                                        if (AIarray[k] % 13 == j) {
                                            tail[index] = AIarray[k];
                                            index += 1;
                                            AIarray[k] = -1;
                                        }
                                    }
                                    break;
                                }
                            }
                        }
                    }
                    if (test2 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        now = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                now[3]++;
                            }
                            if (sys[j] == 2) {
                                now[4]++;
                            }
                        }
                        index = 0;
                        if (now[3] > 0 && now[4] > 0) {
                            test2 = 1;
                            for (let j = 0; j < 13; j++) {
                                if (sys[j] == 3) {
                                    for (let k = 0; k < 16; k++) {
                                        if (AIarray[k] % 13 == j) {
                                            mid[index] = AIarray[k];
                                            index += 1;
                                            AIarray[k] = -1;
                                        }
                                    }
                                    break;
                                }
                            }
                            for (let j = 0; j < 13; j++) {
                                if (sys[j] == 2) {
                                    for (let k = 0; k < 16; k++) {
                                        if (AIarray[k] % 13 == j) {
                                            mid[index] = AIarray[k];
                                            index += 1;
                                            AIarray[k] = -1;
                                        }
                                    }
                                    break;
                                }
                            }
                        }
                    }
                    //同花
                    if (test3 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            if (AIarray[j] > 0 && AIarray[j] < 14) {
                                sys[0]++;
                            }
                            if (AIarray[j] > 13 && AIarray[j] < 27) {
                                sys[1]++;
                            }
                            if (AIarray[j] > 26 && AIarray[j] < 40) {
                                sys[2]++;
                            }
                            if (AIarray[j] > 39) {
                                sys[3]++;
                            }
                        }
                        for (let j = 0; j < 4; j++) {
                            if (sys[j] >= 5) {
                                test3 = 1;
                                for (let k = 0; k < 16; k++) {
                                    if (j == 3 && AIarray[k] > 39) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        if (index == 5) break;
                                    }
                                    else if (AIarray[k] < (14 + 13 * j) && AIarray[k] > (13 * j)) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        if (index == 5) break;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test2 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            if (AIarray[j] > 0 && AIarray[j] < 14) {
                                sys[0]++;
                            }
                            if (AIarray[j] > 13 && AIarray[j] < 27) {
                                sys[1]++;
                            }
                            if (AIarray[j] > 26 && AIarray[j] < 40) {
                                sys[2]++;
                            }
                            if (AIarray[j] > 39){
                                sys[3]++;
                            }
                        }
                        for (let j = 0; j < 4; j++) {
                            if (sys[j] >= 5) {
                                test2 = 1;
                                for (let k = 0; k < 16; k++) {
                                    if (j == 3 && AIarray[k] > 39) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        if (index == 5) break;
                                    }
                                    else if (AIarray[k] < (14 + 13 * j) && AIarray[k] > (13 * j)) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        if (index == 5) break;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    //順子
                    if (test3 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            gold = AIarray[j] % 13;
                            if (gold != 0) {
                                sys[gold - 1] += 1;
                            }
                            else {
                                sys[12] += 1;
                            }
                        }
                        for (let j = 0; j < 9; j++) {
                            if (sys[j] > 0 && sys[j + 1] > 0 && sys[j + 2] > 0 && sys[j + 3] > 0 && sys[j + 4] > 0) {
                                test3 = 1;
                                gold = j + 1;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 2;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 3;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 4;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 5;
                                if (gold == 13) gold = 0;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test2 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            gold = AIarray[j] % 13;
                            if (gold != 0) {
                                sys[gold - 1] += 1;
                            }
                            else {
                                sys[12] += 1;
                            }
                        }
                        for (let j = 0; j < 9; j++) {
                            if (sys[j] > 0 && sys[j + 1] > 0 && sys[j + 2] > 0 && sys[j + 3] > 0 && sys[j + 4] > 0) {
                                test2 = 1;
                                gold = j + 1;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 2;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 3;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 4;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                gold = j + 5;
                                if (gold == 13) gold = 0;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == gold) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                        break;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    //三條
                    if (test3 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                test3 = -2;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test2 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                test2 = -2;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test1 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 3) {
                                test1 = 1;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        head[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    //兩對(略，再補牌時處理)
                    //一對
                    if (test3 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 2) {
                                test3 = -3;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        tail[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test2 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 2) {
                                test2 = -3;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        mid[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                    if (test1 == 0) {
                        sys = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        index = 0;
                        for (let j = 0; j < 16; j++) {
                            sys[AIarray[j] % 13] += 1;
                        }
                        for (let j = 0; j < 13; j++) {
                            if (sys[j] == 2) {
                                test1 = -1;
                                for (let k = 0; k < 16; k++) {
                                    if (AIarray[k] % 13 == j) {
                                        head[index] = AIarray[k];
                                        index += 1;
                                        AIarray[k] = -1;
                                    }
                                }
                                break;
                            }
                        }
                    }
                }
                //排墩可能有缺牌下面補牌(含烏龍)
                AIarray.sort(function (a, b) {//剩下的牌由大排到小
                    return b - a;
                })
                gold = 0;
                if (test3 == 0) {
                    tail[0] = AIarray[gold];
                    gold += 1;
                    tail[1] = AIarray[gold];
                    gold += 1;
                    tail[2] = AIarray[gold];
                    gold += 1;
                    tail[3] = AIarray[gold];
                    gold += 1;
                    tail[4] = AIarray[gold];
                    gold += 1;
                }
                else
                    if (test3 == -3) {
                        tail[2] = AIarray[gold];
                        gold += 1;
                        tail[3] = AIarray[gold];
                        gold += 1;
                        tail[4] = AIarray[gold];
                        gold += 1;
                    }
                    else
                        if (test3 == -2) {
                            tail[3] = AIarray[gold];
                            gold += 1;
                            tail[4] = AIarray[gold];
                            gold += 1;
                        }
                        else
                            if (test3 == -1) {
                                tail[4] = AIarray[gold];
                                gold += 1;
                            }
                if (test2 == 0) {
                    mid[0] = AIarray[gold];
                    gold += 1;
                    mid[1] = AIarray[gold];
                    gold += 1;
                    mid[2] = AIarray[gold];
                    gold += 1;
                    mid[3] = AIarray[gold];
                    gold += 1;
                    mid[4] = AIarray[gold];
                    gold += 1;
                }
                else
                    if (test2 == -3) {
                        mid[2] = AIarray[gold];
                        gold += 1;
                        mid[3] = AIarray[gold];
                        gold += 1;
                        mid[4] = AIarray[gold];
                        gold += 1;
                    }
                    else
                        if (test2 == -2) {
                            mid[3] = AIarray[gold];
                            gold += 1;
                            mid[4] = AIarray[gold];
                            gold += 1;
                        }
                        else
                            if (test2 == -1) {
                                mid[4] = AIarray[gold];
                                gold += 1;
                            }
                if (test1 == 0) {
                    head[0] = AIarray[gold];
                    gold += 1;
                    head[1] = AIarray[gold];
                    gold += 1;
                    head[2] = AIarray[gold];
                    gold += 1;
                }
                else if (test1 == -1) {
                    head[2] = AIarray[gold];
                    gold += 1;
                }
                if (bcd == 1) {
                    B1 = head;
                    B2 = mid;
                    B3 = tail;
                }
                if (bcd == 2) {
                    C1 = head;
                    C2 = mid;
                    C3 = tail;
                }
                if (bcd == 3) {
                    D1 = head;
                    D2 = mid;
                    D3 = tail;
                }
            }
            document.addEventListener("load", getdata(), false);//載入完網頁後讀數據
    </script>
</body>
</html>