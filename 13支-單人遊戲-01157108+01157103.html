<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>13支-單人遊戲</title>
        <style>
            body {
                background-image: url("imgs/牌桌.png");
                background-repeat:no-repeat;
                background-size:cover;
            }
            #deal{
                position:absolute;
                width:10%;
                left:45%;
                top:300px;
            }
            .cards{
                display:none;
                position:absolute;
                width:6%;
                top:610px;
                filter:drop-shadow(red);
            }
            .test1{
                position:absolute;
                width:25%;
                left:30px;
                top:260px;
            }
            .test2 {
                position: absolute;
                height:45%;
                left: 75%;
                top: 245px;
            }
            .system {
                position: absolute;
            }
            #s1 {
                width: 8%;
                top: 34%;
                left:6%;
            }
            #s2 {
                width: 8%;
                top: 34%;
                left: 15%;
            }
            #s3 {
                width: 7%;
                top: 51%;
                left: 2.5%;
            }
            #s4 {
                width: 7%;
                top: 51%;
                left: 11%;
            }
            #s5 {
                width: 7%;
                top: 51%;
                left: 20%;
            }
            #s6 {
                width: 11.5%;
                top: 67%;
                left: 2%;
            }
            #s7 {
                width: 11.5%;
                top: 67%;
                left: 15.5%;
            }
        </style>
    </head >
    <body>
        <div id="all">
            <img src="imgs/發牌.png" onclick="deal()" id="deal" />
            <img src="imgs/n0.png" id="p1" class="cards" />
            <img src="imgs/n0.png" id="p2" class="cards" />
            <img src="imgs/n0.png" id="p3" class="cards" />
            <img src="imgs/n0.png" id="p4" class="cards" />
            <img src="imgs/n0.png" id="p5" class="cards" />
            <img src="imgs/n0.png" id="p6" class="cards" />
            <img src="imgs/n0.png" id="p7" class="cards" />
            <img src="imgs/n0.png" id="p8" class="cards" />
            <img src="imgs/n0.png" id="p9" class="cards" />
            <img src="imgs/n0.png" id="p10" class="cards" />
            <img src="imgs/n0.png" id="p11" class="cards" />
            <img src="imgs/n0.png" id="p12" class="cards" />
            <img src="imgs/n0.png" id="p13" class="cards" />
            <img src="imgs/n0.png" id="p14" class="cards" />
            <img src="imgs/n0.png" id="p15" class="cards" />
            <img src="imgs/n0.png" id="p16" class="cards" />
            <img src="imgs/模擬1.png" class="test1" />
            <img src="imgs/模擬2.png" class="test2" />
            <img src="imgs/系統按鈕1.png" id="s1" class="system" />
            <img src="imgs/系統按鈕2.png" id="s2" class="system" />
            <img src="imgs/系統按鈕3.png" id="s3" class="system" />
            <img src="imgs/系統按鈕4.png" id="s4" class="system" />
            <img src="imgs/系統按鈕5.png" id="s5" class="system" />
            <img src="imgs/系統按鈕6.png" id="s6" class="system" />
            <img src="imgs/系統按鈕7.png" id="s7" class="system" />
        </div>

            <script>
                //有poker串列用0~64代表牌庫，index[0]是彩金牌，index[1]~[16]是玩家1，index[17]~[32]是玩家2，index[33]~[48]是玩家，index[49]~[64]是玩家3的手牌
                //牌型:數字1~13是梅花(c)1~13，14~26是方塊(d)1~13，27~39是紅心(h)1~13，40~65是(s)黑桃1~13共兩次
                let poker = new Array(65);
                let playerA = new Array(16);
                let playerB = new Array(16);
                let playerC = new Array(16);
                let playerD = new Array(16);
                let draw = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
                let temp = 0;
                let word = "";
                let i = 0;
                for (let i = 0; i < 65; i++) {//建立牌組
                    poker[i] = i + 1;
                }
                function shuffle() {//洗牌
                    poker.sort(() => Math.random() - 0.5);
                }
                function show() {
                    for (i = 0; i < 16; i++) {//顯示手牌
                        document.querySelector("#p" + (i + 1)).style.left = i * 95 + 10 + "px";
                        temp = Math.floor(playerA[i] / 13);
                        switch (temp) {
                            case 0://c
                                word = "imgs/c" + playerA[i] + ".png";
                                document.getElementById("p" + (i + 1)).src = word;
                                break;
                            case 1://d
                                if (playerA[i] - 13 != 0) {
                                    word = "imgs/d" + (playerA[i] - 13) + ".png";
                                }
                                else {
                                    word = "imgs/c" + 13 + ".png";
                                }
                                document.getElementById("p" + (i + 1)).src = word;
                                break;
                            case 2://h
                                if (playerA[i] - 26 != 0) {
                                    word = "imgs/h" + (playerA[i] - 26) + ".png";
                                }
                                else {
                                    word = "imgs/d" + 13 + ".png";
                                }
                                document.getElementById("p" + (i + 1)).src = word;
                                break;
                            case 3://s
                                if (playerA[i] - 39 != 0) {
                                    word = "imgs/s" + (playerA[i] - 39) + ".png";
                                }
                                else {
                                    word = "imgs/h" + 13 + ".png";
                                }
                                document.getElementById("p" + (i + 1)).src = word;
                                break;
                            case 4://s
                                if (playerA[i] - 52 != 0) {
                                    word = "imgs/s" + (playerA[i] - 52) + ".png";
                                }
                                else {
                                    word = "imgs/s" + 13 + ".png";
                                }
                                document.getElementById("p" + (i + 1)).src = word;
                                break;
                            case 5://s
                                word = "imgs/s" + 13 + ".png";
                                document.getElementById("p" + (i + 1)).src = word;
                                break;
                        }
                        document.querySelector("#p" + (i + 1)).style.display = "initial";//未來有機會改成用動畫
                    }
                }
                function deal() {//洗牌並發牌給玩家
                    shuffle();
                    document.querySelector("#deal").style.display = "none";
                    for (i = 1; i <= 16; i++) {//發牌(方便使用整理功能而重建)//0~15
                        playerA[i - 1] = poker[i];
                        playerB[i - 1] = poker[i + 16];
                        playerC[i - 1] = poker[i + 32];
                        playerD[i - 1] = poker[i + 48];
                    }
                    show();
                    console.log(poker);//檢查用，後面要刪除
                    console.log(playerA);//檢查用，後面要刪除
                    operate();//操作
                }
                function operate() {
                    //顯示按鈕圖片(未實作)
                    i = 0;//draw的張數
                    let test = 0;
                    //let num = 0;
                    document.getElementById("all").addEventListener("click", function (e) {
                        word = e.target.id;//word用來分辨觸發點擊的物件ID(p:撲克牌 s:系統按鈕 c:牌型按鈕)
                        if (word[0] == 'p') {//點選撲克牌的場合
                            if (word.length == 2) {
                                temp = parseInt(word[1]);//temp是第N張手牌
                            }
                            else {
                                temp = parseInt(word[1]) * 10 + parseInt(word[2]);
                            }
                            test = -1;
                            for (let j = 0; j < 16; j++) {
                                if (draw[j] == temp) {
                                    test = j;
                                    break;
                                }
                            }
                            if (test == -1) {//不在draw裡就加進draw
                                document.querySelector("#" + word).style.top = 580 + "px";
                                for (let j = 0; j < 16; j++) {
                                    if (draw[j] == -1) {
                                        draw[j] = temp;
                                        i++;
                                        break;
                                    }
                                }
                                console.log(draw);
                            }
                            else {//在draw裡就丟出draw
                                document.querySelector("#" + word).style.top = 610 + "px";
                                draw[test] = -1;
                                i--;
                                console.log(draw);
                            }
                        }
                        else
                        if (word[0] == 's') {//點選系統按鈕的場合                              
                            temp = parseInt(word[1]);                         
                            if (temp == 6) {//依照大小
                                for (let j = 0; j < 16; j++) {
                                    if (draw[j] != -1) {
                                        document.querySelector("#p" + draw[j]).style.top = 610 + "px";
                                        draw[j] = -1;
                                    }
                                }
                                i = 0;
                                playerA.sort(function (a, b) {
                                    while (a > 13) {
                                        a -= 13;
                                    }
                                    while (b > 13) {
                                        b -= 13;
                                    }
                                    return a - b;                                    
                                });
                                show();
                            }
                            else {//依照花色
                                for (let j = 0; j < 16; j++) {
                                    if (draw[j] != -1) {
                                        document.querySelector("#p" + draw[j]).style.top = 610 + "px";
                                        draw[j] = -1;
                                    }
                                }
                                i = 0;
                                playerA.sort(function (a, b) {
                                        return a - b;
                                });
                                show();
                            }
                        }
                        else {//點選牌型的場合

                        }
                    }, false);
                }
            </script>
        </body>
    </html >
